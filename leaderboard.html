<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<canvas id="hud-bg"></canvas>
<div class="panel" id="list"></div>

<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

onAuthStateChanged(auth, async user=>{
  if(!user) location.href="index.html";
  const snap = await getDocs(collection(db,"users"));
  let users = snap.docs.map(d=>({id:d.id,...d.data()}));
  users = users.sort((a,b)=>b.points - a.points);

  let rank=1, lastPoints=null, actualRank=1;
  users.forEach(u=>{
    if(lastPoints!==null && u.points!==lastPoints) actualRank=rank;
    lastPoints=u.points;

    const row = document.createElement("div");
    row.className="row";
    let roleLabel = "";
    if(u.role==="moderator") roleLabel=" Модер";
    if(u.role==="elder") roleLabel=" Старший мод.";

    row.innerHTML=`
      <div>${rank}</div>
      <div>${u.nick||"(no nick)"}${roleLabel}</div>
      <div>${u.points}</div>
    `;
    if(u.id===user.uid) row.style.color="#00cfff";

    document.getElementById("list").append(row);
    rank++;
  });
});
</script>
<script src="hudBackground.js"></script>
</body>
</html>
